(function(){var a=document.getElementsByTagName("script");var b=a[a.length-1].src;angular.module("mvAutocomplete",["ngRoute"]).component("mvAutocomplete",{bindings:{searchFunction:"&",searchFields:"=",fieldsToShow:"=",selectedTo:"=",href:"=",exact:"=",clear:"<"},template:'<input type="text" id="mv-autocomplete-{{$ctrl.id}}" ng-change="$ctrl.getList();" ng-model="$ctrl.searchText" autocomplete="off">',controller:c});c.$inject=["$element","$scope","$compile","$timeout","MvUtils"];function c(d,e,g,f,i){var h=this;f(function(){h.id=e.$id;console.log(h.searchFields);console.log(h.fieldsToShow);h.indexSelected=-1;h.searchText="";h.cacheList=[];h.filteredList=[];h.camposAComparar=(h.searchFields)?h.searchFields.split(","):[];h.camposAMostrar=(h.fieldsToShow)?h.fieldsToShow.split(","):[];h.exacto=(h.exact)?h.exact:false;h.clear=(h.clear)?h.clear:false;h.getList=k;h.select=j;function k(){h.searchFunction({callback:function(q){h.cacheList=q;n()}})}function n(){if(h.cacheList!=undefined){h.filteredList=[];h.cacheList.filter(function(s,r,q){h.camposAComparar.forEach(function(u,t,v){if(!h.filteredList.hasOwnProperty(r)){if(s[u]!=null&&((h.exacto&&s[u].toUpperCase()==h.searchText.toUpperCase())||(!h.exacto&&s[u].toUpperCase().indexOf(h.searchText.toUpperCase())>-1))){return h.filteredList[r]=s}}})});m()}}function m(){var q=document.getElementById("mv-autocomplete-panel-"+h.id);if(q!=null){q.remove()}var r="";if(h.filteredList.length>0&&h.searchText.trim().length>0){h.filteredList.forEach(function(u,t,s){r=r+'<li id="mv-autocomplete-li-'+t+'" ng-click="$ctrl.select('+t+')" ng-mouseover="$ctrl.select('+t+", $event)\" ng-class=\"{'mv-autocomplete-selected':$ctrl.indexSelected=='"+t+"'}\">";h.camposAMostrar.forEach(function(y,x,A){if(y.indexOf("[")>-1){var w=y.split(".");var z=w[0].replace("]","").substr(y.indexOf("[")+1);var v=w[0].substr(0,y.indexOf("["));r=r+"<span>"+u[v][z][w[1]]+"</span> "}else{r=r+"<span>"+u[y]+"</span> "}});r=r+"</li>"});d.append(g('<ul class="mv-autocomplete-panel" id="mv-autocomplete-panel-'+h.id+'">'+r+"</ul>")(e));j(Object.keys(h.filteredList)[0])}else{j(-1)}}function j(q,r){f(function(){if(q==-1){h.selectedTo={}}else{h.selectedTo=angular.copy(h.filteredList[q]);if(r==undefined){var v=angular.element(document.querySelector("#mv-autocomplete-panel-"+h.id));var t=0;var u=false;if(v[0]!=undefined){for(var s=0;s<v[0].childNodes.length;s++){if(v[0].childNodes[s].id.split("-")[3]==q){u=s;break}else{u=-1}}for(var s=0;s<u;s++){t=t+v[0].childNodes[s].getBoundingClientRect().height}if(u==-1){v[0].scrollTop=0}else{v[0].scrollTop=t}}}}h.indexSelected=q},0)}d.children().bind("blur",function(){o()});d.bind("keyup focus",function(r){if(r.keyCode==40){var q=p(h.indexSelected);h.indexSelected=(q.nextIndex==undefined)?q.firstIndex:q.nextIndex;j(h.indexSelected);l()}if(r.keyCode==38){var q=p(h.indexSelected);h.indexSelected=(q.prevIndex==undefined)?q.lastIndex:q.prevIndex;j(h.indexSelected);l()}if(r.keyCode==13){o()}});function o(){if(h.searchText==undefined||h.searchText.trim().length==0||h.filteredList.length==0){j(-1)}else{j(h.indexSelected);h.searchText=h.selectedTo[h.camposAMostrar[0]]}var q=document.getElementById("mv-autocomplete-panel-"+h.id);if(q!=null){q.remove()}}function l(){var q=h.searchText;h.searchText="";f(function(){h.searchText=q},0)}function p(w){var u=Object.keys(h.filteredList);var t=u.indexOf(w);var q=u[t+1];var s=u[t-1];var r=u[0];var v=u[u.length-1];return{nextIndex:q,prevIndex:s,firstIndex:r,lastIndex:v}}},100)}})();