(function(){"use strict";var scripts=document.getElementsByTagName("script");var currentScriptPath=scripts[scripts.length-1].src;angular.module("acAutocomplete",["ngRoute"]).component("acAutocomplete",{bindings:{searchFunction:"&",searchFields:"=",fieldsToShow:"=",selectedTo:"=",href:"=",exact:"="},template:""+'<input type="text" '+'id="ac-autocomplete-{{$ctrl.id}}" '+'ng-change="$ctrl.getList();" '+'ng-model="$ctrl.searchText">',controller:AcAutocompleteController});AcAutocompleteController.$inject=["$element","$scope","$compile","$timeout","AcUtils"];function AcAutocompleteController($element,$scope,$compile,$timeout,AcUtils){var vm=this;vm.id=$scope.$id;vm.indexSelected=-1;vm.searchText="";vm.cacheList=[];vm.filteredList=[];vm.camposAComparar=vm.searchFields?vm.searchFields.split(","):[];vm.camposAMostrar=vm.fieldsToShow?vm.fieldsToShow.split(","):[];vm.exacto=vm.exact?vm.exact:false;vm.getList=getList;vm.select=select;function getList(){if(vm.cacheList==undefined||vm.cacheList.length==0){vm.searchFunction({callback:function(data){vm.cacheList=data;filter()}})}else{filter()}}function filter(){if(vm.cacheList!=undefined){vm.filteredList=[];vm.cacheList.filter(function(e,i,a){vm.camposAComparar.forEach(function(elem,index,array){if(!vm.filteredList.hasOwnProperty(i)){if(vm.exacto&&e[elem].toUpperCase()==vm.searchText.toUpperCase()||!vm.exacto&&e[elem].toUpperCase().indexOf(vm.searchText.toUpperCase())>-1){return vm.filteredList[i]=e}}})});finish()}}function finish(){var panel=document.getElementById("ac-autocomplete-panel-"+vm.id);if(panel!=null){panel.remove()}var detalle="";if(vm.filteredList.length>0&&vm.searchText.trim().length>0){vm.filteredList.forEach(function(e,i,a){detalle=detalle+'<li ng-click="$ctrl.select('+i+')" '+'ng-mouseover="$ctrl.select('+i+')" '+"ng-class=\"{'ac-autocomplete-selected':$ctrl.indexSelected=='"+i+"'}\">";vm.camposAMostrar.forEach(function(elem,index,array){detalle=detalle+"<span>"+e[elem]+"</span> "});detalle=detalle+"</li>"});$element.append($compile('<ul class="ac-autocomplete-panel" id="ac-autocomplete-panel-'+vm.id+'">'+detalle+"</ul>")($scope));select(Object.keys(vm.filteredList)[0])}else{select(-1)}}function select(index){$timeout(function(){if(index==-1){vm.selectedTo={}}else{vm.selectedTo=vm.filteredList[index]}vm.indexSelected=index},0)}$element.children().bind("blur",function(){onLeave()});$element.bind("keyup focus",function(event){if(event.keyCode==40){var index=getIndex(vm.indexSelected);vm.indexSelected=index.nextIndex==undefined?index.firstIndex:index.nextIndex;select(vm.indexSelected);moveCursorToEnd()}if(event.keyCode==38){var index=getIndex(vm.indexSelected);vm.indexSelected=index.prevIndex==undefined?index.lastIndex:index.prevIndex;select(vm.indexSelected);moveCursorToEnd()}if(event.keyCode==13){onLeave()}});function onLeave(){if(vm.searchText.trim().length==0||vm.filteredList.length==0){select(-1)}else{select(vm.indexSelected);vm.searchText=vm.selectedTo[vm.camposAMostrar[0]]}var panel=document.getElementById("ac-autocomplete-panel-"+vm.id);if(panel!=null){panel.remove()}}function moveCursorToEnd(){var tmp=vm.searchText;vm.searchText="";$timeout(function(){vm.searchText=tmp},0)}function getIndex(prop){var listaProps=Object.keys(vm.filteredList);var actualIndex=listaProps.indexOf(prop);var nextIndex=listaProps[actualIndex+1];var prevIndex=listaProps[actualIndex-1];var firstIndex=listaProps[0];var lastIndex=listaProps[listaProps.length-1];return{nextIndex:nextIndex,prevIndex:prevIndex,firstIndex:firstIndex,lastIndex:lastIndex}}}})();